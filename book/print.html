<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>BIT :: LT :: MySQL DB :: 7 slides :: additional sql</title>
    <meta name="robots" content="noindex" />
    <!-- Custom HTML head -->
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.png">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/general.css">
    <link rel="stylesheet" href="css/chrome.css">
    <link rel="stylesheet" href="css/print.css" media="print">
    <!-- Fonts -->
    <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
    <link rel="stylesheet" href="fonts/fonts.css">
    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="tomorrow-night.css">
    <link rel="stylesheet" href="ayu-highlight.css">

    <!-- Custom theme stylesheets -->
</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('light')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded "><a href="select_into.html"><strong aria-hidden="true">1.</strong> The INSERT INTO statement</a></li><li class="chapter-item expanded "><a href="create_table_like.html"><strong aria-hidden="true">2.</strong> The CREATE TABLE ... LIKE statement</a></li><li class="chapter-item expanded "><a href="create_table_select.html"><strong aria-hidden="true">3.</strong> The CREATE TABLE ... SELECT statement</a></li><li class="chapter-item expanded "><a href="bulk_insert_statement.html"><strong aria-hidden="true">4.</strong> Loading Data from Comma-Delimited Files</a></li><li class="chapter-item expanded "><a href="write_data_to_file.html"><strong aria-hidden="true">5.</strong> Exporting Data to Comma-Delimitted Files</a></li><li class="chapter-item expanded "><a href="sequency.html"><strong aria-hidden="true">6.</strong> Sequence</a></li><li class="chapter-item expanded "><a href="modifying_data_through_table_expression.html"><strong aria-hidden="true">7.</strong> Modifying data through join</a></li><li class="chapter-item expanded "><a href="modification_with_top.html"><strong aria-hidden="true">8.</strong> Modifications with LIMIT and OFFSET-FETCH</a></li><li class="chapter-item expanded "><a href="window_functions.html"><strong aria-hidden="true">9.</strong> Window functions</a></li><li class="chapter-item expanded "><a href="exercise_1.html"><strong aria-hidden="true">10.</strong> Exercise 1</a></li><li class="chapter-item expanded "><a href="exercise_3.html"><strong aria-hidden="true">11.</strong> Exercise 2</a></li><li class="chapter-item expanded "><a href="exercise_4.html"><strong aria-hidden="true">12.</strong> Exercise 3</a></li><li class="chapter-item expanded "><a href="exercise_5.html"><strong aria-hidden="true">13.</strong> Exercise 4</a></li><li class="chapter-item expanded "><a href="exercise_6.html"><strong aria-hidden="true">14.</strong> Exercise 5</a></li><li class="chapter-item expanded "><a href="exercise_7.html"><strong aria-hidden="true">15.</strong> Exercise 6</a></li><li class="chapter-item expanded "><a href="querying_metada.html"><strong aria-hidden="true">16.</strong> Querying metadata</a></li><li class="chapter-item expanded "><a href="merge_data.html"><strong aria-hidden="true">17.</strong> Merge data?</a></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">
        <div class="page">
            <div id="menu-bar-hover-placeholder"></div>
<header class="page-header">
    <a href="/">
        <img class="page-header-w" src="favicon.svg" alt="Logo">
    </a>
    <h1 class="page-header-text">LearningQueue</h1>
</header>            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                </div>

                <h1 class="menu-title">BIT :: LT :: MySQL DB :: 7 slides :: additional sql</h1>

                <div class="right-buttons">
                    <a href="print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                </div>
            </div>

            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..."
                        aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>
            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <h1 id="the-insert-into-statement"><a class="header" href="#the-insert-into-statement">The INSERT INTO statement</a></h1>
<ul>
<li>The INSERT INTO statement is a standard SQL statement that creates populates a target table with the result set of a query.</li>
</ul>
<pre><code class="language-sql">INSERT INTO tbl_temp2 (fld_id)
    SELECT tbl_temp1.fld_order_id
    FROM tbl_temp1 WHERE tbl_temp1.fld_order_id &gt; 100;
</code></pre>
<p>Think about INSERT INTO like a <code>copy paste</code></p>
<p>The target table’s structure and data must be based on the source table. The INSERT INTO statement copies from the source to the target.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-create-table--like-statement"><a class="header" href="#the-create-table--like-statement">The CREATE TABLE ... LIKE statement</a></h1>
<p>Use CREATE TABLE ... LIKE to create an empty table based on the definition of another table, including any column attributes and indexes defined in the original table:</p>
<pre><code class="language-sql">CREATE TABLE new_tbl LIKE orig_tbl;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="the-create-table--select-statement"><a class="header" href="#the-create-table--select-statement">The CREATE TABLE ... SELECT statement</a></h1>
<p>You can create one table from another by adding a SELECT statement at the end of the CREATE TABLE statement:</p>
<pre><code class="language-sql">CREATE TABLE new_tbl [AS] SELECT * FROM orig_tbl;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="loading-data-from-comma-delimited-files"><a class="header" href="#loading-data-from-comma-delimited-files">Loading Data from Comma-Delimited Files</a></h1>
<p>You use the <em>LOAD DATA INFILE</em> statement to insert into an existing table data originating from a file. </p>
<pre><code class="language-sql">LOAD DATA INFILE 'some_file.csv' INTO TABLE some_table
FIELDS TERMINATED BY ',' LINES TERMINATED BY ';';
</code></pre>
<ul>
<li>Create a simple Car table with type column as varchar, number column as varchar</li>
<li>Create file cars.txt with conext like:</li>
</ul>
<pre><code>skoda,rlt111
toyouta,mnt233
honda,mrt123
</code></pre>
<ul>
<li>Upload data to your created table</li>
</ul>
<p>Note: By default, MySQL doesn’t let you load any data using the LOAD DATA INFILE command. The behavior is controlled by the secure_file_priv system variable. </p>
<p>You need to put this file in:</p>
<pre><code class="language-sql">SELECT @@secure_file_priv;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exporting-data-to-comma-delimitted-files"><a class="header" href="#exporting-data-to-comma-delimitted-files">Exporting Data to Comma-Delimitted Files</a></h1>
<p>You can export file to csv file as well:</p>
<pre><code class="language-sql">SELECT emp_no, first_name, last_name, title, from_date
    FROM employees JOIN titles USING (emp_no)
    WHERE title = 'Manager' AND to_date = '9999-01-01'
    INTO OUTFILE '/var/lib/mysql-files/managers.csv'
    FIELDS TERMINATED BY ',';
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sequence"><a class="header" href="#sequence">Sequence</a></h1>
<p>In MySQL, a sequence is a list of integers generated in the ascending order i.e., 1, 2, 3...</p>
<p>To create a sequence in MySQL automatically, you set the AUTO_INCREMENT attribute for a column, which typically is a primary key column.</p>
<p>The following rules are applied when you use the AUTO_INCREMENT attribute:</p>
<ul>
<li>Each table has only one AUTO_INCREMENT column whose data type is typically the integer.</li>
<li>The  AUTO_INCREMENT column must be indexed, which means it can be either PRIMARY KEY or UNIQUE index.</li>
<li>The AUTO_INCREMENT column must have a NOT NULL constraint. When you set the AUTO_INCREMENT attribute to a column, MySQL automatically adds the NOT NULL  constraint to the column implicitly.</li>
</ul>
<p>It is not possible to create a cusomt sequence like in MSSQL or Oracle or PostgreSQL:</p>
<pre><code class="language-sql">CREATE SEQUENCE [dbo].[SeqMaxOrderId] AS INT
  MINVALUE 1,
  MAXVALUE 10
  CYCLE; -- Reset to min value after max value reached
</code></pre>
<p>We can use the LAST_INSERT_ID() function to get the last generated sequence number. However, we can also use the last insert ID for the subsequent statements that should be unique across sessions.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modifying-data-through-join"><a class="header" href="#modifying-data-through-join">Modifying data through join</a></h1>
<p>Example:</p>
<pre><code class="language-sql">UPDATE OrderDetails AS OD
  INNER JOIN Orders AS O
  ON OD.orderid = O.orderid
SET discount = discount + 0.05
WHERE O.custid = 1;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modifications-with-limit-and-offset-fetch"><a class="header" href="#modifications-with-limit-and-offset-fetch">Modifications with LIMIT and OFFSET-FETCH</a></h1>
<ul>
<li>SQL supports using the LIMIT option directly in INSERT, UPDATE, DELETE, and MERGE statements.</li>
<li>The OFFSET-FETCH filter is not allowed directly in modifications because this filter requires an ORDER BY clause and modification statements don’t support one.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="window-functions"><a class="header" href="#window-functions">Window functions</a></h1>
<p>A window function is a function that, for each row, computes a scalar result value based on a calculation against a subset of the rows from the underlying query.</p>
<p>MySQL supports window functions that, for each row from a query, perform a calculation using rows related to that row.</p>
<p>More detailed describtion:</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html">https://dev.mysql.com/doc/refman/8.0/en/window-function-descriptions.html</a></p>
<p>Let's look at MySQL examples:</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html">https://dev.mysql.com/doc/refman/8.0/en/window-functions-usage.html</a></p>
<pre><code class="language-sql">SELECT empid, ordermonth, val,
  SUM(val) OVER(PARTITION BY empid
                ORDER BY ordermonth) AS runval
FROM EmpOrders;
</code></pre>
<pre><code class="language-sql">SELECT empid, ordermonth, val, SUM(val), AVG(val)
FROM EmpOrders
GROUP BY empid, ordermonth, val
ORDER BY ordermonth;
</code></pre>
<p>One of the great advantages of window functions is that they don’t hide the detail. This means you can write expressions that mix detail and aggregates. The next example demonstrates this:</p>
<pre><code class="language-sql">SELECT orderid, custid, val,
  100 * val / SUM(val) OVER() AS pctall,
  100 * val / SUM(val) OVER(PARTITION BY custid) AS pctcust
FROM OrderValues;
</code></pre>
<p>Other example:</p>
<pre><code class="language-sql">SELECT
         orderdate,
            freight,
         ROW_NUMBER()   OVER(PARTITION BY YEAR(orderdate)) AS `row_number`,
         SUM(freight)   OVER(PARTITION BY YEAR(orderdate)) AS `total_freight_for_order_year`
       FROM Orders
ORDER BY orderdate;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-1"><a class="header" href="#exercise-1">Exercise 1</a></h1>
<p>Execute code</p>
<pre><code class="language-sql">DROP TABLE IF EXISTS CustomersWithOrders;

CREATE TABLE CustomersWithOrders
(
  custid      INT         NOT NULL PRIMARY KEY,
  companyname VARCHAR(40) NOT NULL,
  country     VARCHAR(15) NOT NULL,
  region      VARCHAR(15) NULL,
  city        VARCHAR(15) NOT NULL
);
</code></pre>
<p>Insert into the <em>CustomersWithOrders</em> table a row with the following information:</p>
<ul>
<li>custid: 100</li>
<li>companyname: Coho Winery</li>
<li>country: USA</li>
<li>region: WA</li>
<li>city: Redmond</li>
</ul>
<p>Insert into the <em>CustomersWithOrders</em> table all customers who placed orders.</p>
<p>Tables involed: <em>Orders</em>, <em>Customers</em>, <em>CustomersWithOrders</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-2"><a class="header" href="#exercise-2">Exercise 2</a></h1>
<pre><code class="language-sql">DROP TABLE IF EXISTS Orders2014_2016;

CREATE TABLE Orders2014_2016
(
    orderid        int                         not null,
    custid         int                         null,
    empid          int                         not null,
    orderdate      date                        not null,
    requireddate   date                        not null,
    shippeddate    date                        null,
    shipperid      int                         not null,
    freight        decimal(10, 2) default 0.00 not null,
    shipname       varchar(40) charset utf8mb3 not null,
    shipaddress    varchar(60) charset utf8mb3 not null,
    shipcity       varchar(15) charset utf8mb3 not null,
    shipregion     varchar(15) charset utf8mb3 null,
    shippostalcode varchar(10) charset utf8mb3 null,
    shipcountry    varchar(15) charset utf8mb3 not null
);
</code></pre>
<p>Use a <em>INSERT INTO</em> statement to populate the <em>Orders2014_2016</em> table with orders from the <em>Orders</em> table that were placed in the years 2014 through 2016.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-3"><a class="header" href="#exercise-3">Exercise 3</a></h1>
<p>By using CREATE TABLE ... SELECT statement create a copy of <em>Orders</em> table. Name it as <em>OrdersForDeletion</em></p>
<p>Delete from the <em>OrdersForDeletion</em> table orders that were placed before August 2014.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-4"><a class="header" href="#exercise-4">Exercise 4</a></h1>
<p>Delete from the <em>OrdersForDeletion</em> table orders placed by customers from Brazil.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-5"><a class="header" href="#exercise-5">Exercise 5</a></h1>
<p>By using CREATE TABLE ... SELECT statement create a copy of <em>Customers</em> table. Name it as <em>CustomersForUpdate</em></p>
<p>Run the following query against <em>CustomersForUpdate</em>, and notice that some rows have a NULL in the region column:</p>
<pre><code class="language-sql">SELECT * FROM CustomersForUpdate;
</code></pre>
<p>The output from this query is as follows:</p>
<pre><code class="language-sql">custid      companyname      country         region     city
----------- ---------------- --------------- ---------- ---------------
1           Customer NRZBB   Germany         NULL       Berlin
2           Customer MLTDN   Mexico          NULL       México D.F.
3           Customer KBUDE   Mexico          NULL       México D.F.
4           Customer HFBZG   UK              NULL       London
5           Customer HGVLZ   Sweden          NULL       Luleå
6           Customer XHXJV   Germany         NULL       Mannheim
7           Customer QXVLA   France          NULL       Strasbourg
8           Customer QUHWH   Spain           NULL       Madrid
9           Customer RTXGC   France          NULL       Marseille
10          Customer EEALV   Canada          BC         Tsawassen
...

(90 row(s) affected)
</code></pre>
<p>Update the <em>CustomersForUpdate</em> table, and change all NULL region values to <None>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="exercise-6"><a class="header" href="#exercise-6">Exercise 6</a></h1>
<p>By using CREATE TABLE ... SELECT statement create a copy of <em>Orders</em> table. Name it as <em>OrdersForUpdate</em></p>
<p>Update all orders in the <em>OrdersForUpdate</em> table that were placed by United Kingdom customers, and set their shipcountry, shipregion, and shipcity values to the country, region, and city values of the corresponding customers.</p>
<p>Tables involved: <em>OrdersForUpdate</em>, <em>Customers</em></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="querying-metadata"><a class="header" href="#querying-metadata">Querying metadata</a></h1>
<p>MySQL Server provides statements for getting information about the objects, such as information about tables in a database and columns in a table. Those tools include information schema views, and specific non standart sql statements.</p>
<h2 id="non-standart-sql-statements"><a class="header" href="#non-standart-sql-statements">Non standart sql statements</a></h2>
<pre><code class="language-sql">SHOW DATABASES;
SHOW TABLES;
DESCRIBE table_name;
SHOW COLUMNS FROM table_name;
SHOW WARNINGS;
</code></pre>
<h2 id="information-schema-views"><a class="header" href="#information-schema-views">information schema views</a></h2>
<p>INFORMATION_SCHEMA is a database within each MySQL instance, the place that stores information about all the other databases that the MySQL server maintains.</p>
<pre><code class="language-sql">SELECT table_name, table_type, engine
    FROM information_schema.tables
    WHERE table_schema = 'lessons'
    ORDER BY table_name;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="merge--replace-data"><a class="header" href="#merge--replace-data">Merge / replace data?</a></h1>
<p>For data merging we can use <em>INSERT ... ON DUPLICATE KEY</em> or <em>REPLACE ... ON DUPLICATE KEY</em>.</p>
<pre><code class="language-sql">REPLACE table_name (col1, col2, col3)
    VALUES (2, 'val1', 'val2'),
    (3, 'val3', 'val4');

INSERT INTO table_name (col1, col2, col3)
    VALUES (1, 'val1', 'val2')
    ON DUPLICATE KEY UPDATE first_name = 'val1', last_name = 'val2';
</code></pre>

                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
        </nav>

    </div>

    <!-- Livereload script (if served using the cli tool) -->
    <script type="text/javascript">
        var socket = new WebSocket("ws://localhost:3000/__livereload");
        socket.onmessage = function (event) {
            if (event.data === "reload") {
                socket.close();
                location.reload();
            }
        };

        window.onbeforeunload = function () {
            socket.close();
        }
    </script>
    <script type="text/javascript">
        window.playground_copyable = true;
    </script>
    <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
    <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="book.js" type="text/javascript" charset="utf-8"></script>

    <!-- Custom JS scripts -->
    <script type="text/javascript">
        window.addEventListener('load', function () {
            window.setTimeout(window.print, 100);
        });
    </script>
</body>

</html>